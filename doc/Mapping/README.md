# Mapping

映射是定义文档及其包含的字段的存储和索引方式的过程。 例如，使用映射来定义：

- 应将哪些字符串字段视为全文字段。
- 哪些字段包含数字，日期或地理位置。
- 是否应将文档中所有字段的值索引到catch-all _all字段中。
- 日期值的格式。
- 用于控制动态添加字段的映射的自定义规则。

## Mapping Type

每个索引都有一种映射类型，用于确定文档的索引方式。

一种映射类型有以下内容:

- Meta-fields, 用于自定义文档的元数据关联的处理方式。元字段的示例包括文档的_index，_type，_id和_source字段。
- Field or properties, 映射类型包含与文档相关的字段或属性列表。

## Field datatypes

每个字段都有一个数据类型，可以是：

- 简单类型, 如text, keyword, date, long, double, boolean或者ip
- 支持JSON的分层特性的类型，如object或者nested
- 特殊类型, 如geo_point, geo_shape, 或者completion

为不同目的以不同方式索引相同字段通常很有用。 
例如，字符串字段可以被索引为用于全文搜索的文本字段，以及用于排序或聚合的关键字字段。
或者，您可以使用标准分析器，英语分析器和法语分析器索引字符串字段。

这是多字段的目的。 大多数数据类型都通过fields参数支持多字段。

## Settings to prevent mappings explosionedit

在索引中定义太多字段是一种可能导致映射爆炸的情况，这可能导致内存不足错误和难以恢复的情况。 
这个问题可能比预期更常见。 例如，考虑插入的每个新文档都会引入新字段的情况。 这在动态映射中非常常见。 
每次文档包含新字段时，这些字段最终都会出现在索引的映射中。 
这并不需要担心少量数据，但随着映射的增加，它可能会成为一个问题。 
以下设置允许您限制手动或动态创建的字段映射的数量，以防止不良好的文档导致映射爆炸：

- index.mapping.total_fields.limit, 索引中的最大字段数。
字段和对象映射以及字段别名都计入此限制。 默认值为1000。
- index.mapping.depth.limit, 字段的最大深度，以内部对象的数量来衡量。 
例如，如果所有字段都在根对象级别定义，则深度为1.如果有一个object类型的映射，则深度为2，等等。默认值为20。
- index.mapping.nested_fields.limit, 索引中嵌套字段的最大数量，默认为50.
索引1个包含100个nested字段的文档实际上索引101个文档，因为每个nested文档都被索引为单独的隐藏文档。

## Dynamic mapping

在使用之前可以不需要定义字段和映射类型。 
由于动态映射，只需索引文档即可自动添加新的字段名称。 
可以将新字段添加到顶级映射类型，内部object和nested字段。

可以配置动态映射规则用于新字段映射的定义。

## Explicit mappings

您对数据的了解比Elasticsearch可以猜到的更多，
因此虽然动态映射对于入门很有用，但在某些时候您需要指定自己的显式映射。

您可以在创建索引时创建字段映射，
也可以使用PUT mapping API将字段添加到现有索引。

## Updating existing field mappings

**文档中已有的字段映射无法更新**。 更改映射意味着使已编制索引的文档无效。 
相反，您应该使用正确的映射创建一个新索引，并将数据重新索引到该索引中。 
如果您只想重命名字段而不更改其映射，则引入别名字段可能是有意义的。

---
